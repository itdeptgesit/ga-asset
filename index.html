<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Daftar Aset GA</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
  <div class="max-w-7xl mx-auto px-6 py-8">
    <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">📦 Daftar Aset GA</h1>

    <!-- Search + Tambah Aset -->
    <div class="flex items-center justify-between mb-4 flex-wrap gap-2">
      <input type="text" id="searchInput" placeholder="🔍 Cari aset..."
        class="w-full sm:w-auto flex-1 px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring focus:border-blue-300 bg-white text-sm" />

      <a href="https://forms.gle/A7dVQx2bsCvvzitG6" target="_blank"
         class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold px-4 py-2 rounded-lg shadow transition">
        <i data-lucide="plus" class="w-4 h-4"></i> Tambah Aset
      </a>
    </div>

    <!-- Table -->
    <div class="overflow-auto rounded-xl shadow border border-gray-200 bg-white">
      <table id="assetTable" class="min-w-full text-sm text-left divide-y divide-gray-200">
        <thead class="bg-gray-100 text-gray-700 sticky top-0 z-10">
          <tr></tr>
        </thead>
        <tbody class="divide-y divide-gray-100 bg-white"></tbody>
      </table>
    </div>

    <!-- Pagination Controls -->
    <div class="mt-6 flex items-center justify-between text-sm">
      <div class="flex items-center gap-2">
        <label for="rowsPerPage" class="text-gray-600">Baris per halaman:</label>
        <select id="rowsPerPage" class="border rounded px-2 py-1">
          <option>5</option>
          <option selected>10</option>
          <option>25</option>
          <option>50</option>
        </select>
      </div>
      <div class="flex items-center gap-3">
        <button id="prevPage" class="px-3 py-1 border rounded text-gray-600 hover:bg-gray-100">&larr; Prev</button>
        <span id="pageInfo" class="text-gray-700"></span>
        <button id="nextPage" class="px-3 py-1 border rounded text-gray-600 hover:bg-gray-100">Next &rarr;</button>
      </div>
    </div>
  </div>

  <script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTI-SPAhj1XTcYOCFPZdkJwocC4Djmm0dsiocUNmQCEK5zsJLNKK7eBVN8Tdms1N0wafsq5bq71oh2A/pub?output=csv';

    let fullData = [];
    let filteredData = [];
    let currentPage = 1;
    let rowsPerPage = 10;

    Papa.parse(sheetUrl, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: results => {
        fullData = results.data.map(row => {
          const { Timestamp, qr_link, qr_code_image, ...rest } = row;
          return rest;
        });
        filteredData = [...fullData];
        renderTable();
      },
      error: err => console.error('Gagal memuat data:', err)
    });

    function getPaginatedData() {
      const start = (currentPage - 1) * rowsPerPage;
      return filteredData.slice(start, start + rowsPerPage);
    }

    function renderTable() {
      const table = document.getElementById('assetTable');
      const thead = table.querySelector('thead tr');
      const tbody = table.querySelector('tbody');
      thead.innerHTML = '';
      tbody.innerHTML = '';

      if (filteredData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="100%" class="p-4 text-center text-gray-500">Tidak ada data.</td></tr>';
        return;
      }

      const keys = Object.keys(filteredData[0]);
      const reorderedKeys = ['id', ...keys.filter(k => k !== 'id')];

      reorderedKeys.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        th.className = 'px-4 py-3 border-b font-semibold tracking-wide text-xs uppercase bg-gray-100';
        thead.appendChild(th);
      });

      const thAction = document.createElement('th');
      thAction.textContent = 'Aksi';
      thAction.className = 'px-4 py-3 border-b font-semibold tracking-wide text-xs uppercase bg-gray-100';
      thead.appendChild(thAction);

      getPaginatedData().forEach((row, index) => {
        const tr = document.createElement('tr');
        tr.className = index % 2 === 0 ? 'bg-white hover:bg-gray-50 transition' : 'bg-gray-50 hover:bg-gray-100 transition';

        reorderedKeys.forEach(key => {
          const td = document.createElement('td');
          td.textContent = row[key] || '-';
          td.className = 'px-4 py-2 whitespace-nowrap text-gray-700';
          tr.appendChild(td);
        });

        const tdAction = document.createElement('td');
        tdAction.className = 'px-4 py-2 whitespace-nowrap';

        if (row.id && row.id.trim() !== '') {
          tdAction.innerHTML = `
            <a href="view.html?id=${row.id}" title="Lihat Detail"
              class="inline-flex items-center gap-1 text-blue-600 hover:underline text-sm font-medium">
              <i data-lucide="eye" class="w-4 h-4"></i> Lihat
            </a>`;
        } else {
          tdAction.textContent = '-';
        }

        tr.appendChild(tdAction);
        tbody.appendChild(tr);
      });

      if (window.lucide?.createIcons) lucide.createIcons();

      const totalPages = Math.ceil(filteredData.length / rowsPerPage);
      document.getElementById('pageInfo').textContent = `Halaman ${currentPage} dari ${totalPages}`;
      document.getElementById('prevPage').disabled = currentPage === 1;
      document.getElementById('nextPage').disabled = currentPage === totalPages;
    }

    // Search
    document.getElementById('searchInput').addEventListener('input', function (e) {
      const keyword = e.target.value.toLowerCase();
      filteredData = fullData.filter(row =>
        Object.values(row).some(value =>
          (value || '').toLowerCase().includes(keyword)
        )
      );
      currentPage = 1;
      renderTable();
    });

    // Pagination controls
    document.getElementById('prevPage').addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
      }
    });

    document.getElementById('nextPage').addEventListener('click', () => {
      const totalPages = Math.ceil(filteredData.length / rowsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        renderTable();
      }
    });

    document.getElementById('rowsPerPage').addEventListener('change', function () {
      rowsPerPage = parseInt(this.value);
      currentPage = 1;
      renderTable();
    });
  </script>
</body>
</html>
